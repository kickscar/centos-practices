03. Nginx

## 소개
 세계 4억 5천여개에 달하는 웹사이트가 Nginx를 통해 서비스할 정도로 2002년, 첫 버전이 출시된 이 후로 괄목할 만한 성장세를 보이고 있는 오픈소스 웹서버 소프트웨어다. 현재(2021년, 8월) 아파치(Apache) 웹서버와 시장을 동등한 수준으로 양분하고 있지만 새로운 서비스들이 Nginx를 선택하고 있는 추세이고 기존 아파치 웹서버에서 마이그레이션도 꾸준히 증가하고 있기 때문에 조만간 앞지를 것이다.
 
 이러한 인기의 이유에는 최초, 이고르 시쇼브(Игорь Сысоев) 1가볍고 2강력한 웹서버 개발을 목표로
 ...
 1쉬운 설치와 2고성능 트랙픽 처리로 결론내자.
 
1.	너무 많은 Apache 웹서버(httpd)의 확장 모듈... -> 기본 모듈도 보통 서비스에서 다 사용하지 않기 때문에 서버 리소스만 낭비한다.
2.	Apache 웹서버의 필수 모듈보다 빠르다.
3.	Apache httpd의 데몬 스레드 혹은 포크(프로세스)기반의 구조 대신 비동기 이벤트 기반의 구조
4.	웹서버 뿐만 아니라 단순한 프록시 역할을 넘어 고성능 로드 밸런서, 리버스 프록시, API 게이트웨이등 MSA(마이크로서비스) 아키텍처와 클라우드 환경에 최적화된 웹서버로 아파치 웹서버와 분명한 차별성을 가지고 있다.
5.	콘텐츠 캐싱을 통한 원본 서버의 부하를 혁신적으로 감소하는 것도 큰 장점


Subjects...(아마도 이런 주제들? 토픽들?)

part0. Authentication and Security Control
part1. Load Balancing
part2. Traffic Management
part3. Caching
part4. Automation

Technical Terms(아니면, 이런 기술들?)
HTTP/2,
WebSocket,
Media Streaming,
Cloud and Container Environments,
Monitoring,
Debugging,
Performance,
Operational Tips


 
## 설치(CentOS7+)

### yum 설치

1.	Nginx 공식 패키지 저장소 등록
	
	저장소 디스크립션 파일 nginx.repo를 다음 위치에 생성한다.
	
	```
	# vi /etc/yum.repos.d/nginx.repo
	```

	내용은 다음과 같다.
	
	```sh
	[nginx]
	name=nginx repo
	baseurl=http://nginx.org/packages/mainline/centos/7/$basearch/
	gpgcheck=0
	enabled=1
	```

2.	설치
	
	```
	# yum install -y nginx
	```
	
	다음 명령으로 설치 상태를 확인할 수 있다.
	
	```
	# ngnix -v
	nginx version: nginx/1.21.4
	
	```
	
3.	서비스 등록

	```
	# systemctl enabled nginx
	```
		
### 소스 컴파일 설치



## 서버 실행

```
# systemctl start nginx
```
	
 정상적으로 데몬이 실행되었는지 확인해 보자
	
```
# ps -ef | grep nginx

root     23003     1  0 15:10 ?        00:00:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
nginx    23004 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23005 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23006 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23007 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23008 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23009 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23010 23003  0 15:10 ?        00:00:00 nginx: worker process
nginx    23011 23003  0 15:10 ?        00:00:00 nginx: worker process
```
	
 정상적으로 nginx 데몬이 실행되었다면, 한 개의 master 프로세스와 한 개 이상의 worker 프로세스가 실행 중인 모습을 볼 수 있다. 이제 요청에 대한 서버의 응답을 확인해보자. curl 명령이나 웹브라우저로 요청을 보내보자.
	
```
# curl localhost

<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
...
```
	
 문제가 없다면, 기본 HTML 문서인 nginx 환영메세지(Welcome to nginx!)가 보일 것이다.


## Nginx 기본

### 주요 명령어

1.	버전 및 빌드 확인

	```
	# nginx -v
	nginx version: nginx/1.21.4
	
	# nginx -V
	nginx version: nginx/1.21.4
	built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) 
	built with OpenSSL 1.0.2k-fips  26 Jan 2017
	TLS SNI support enabled
	...
	
	```
	
2.	설정 테스트

	```
	# nginx -T
	ginx: the configuration file /etc/nginx/nginx.conf syntax is ok
	nginx: configuration file /etc/nginx/nginx.conf test is successful
	# configuration file /etc/nginx/nginx.conf:
	...
	...
	
	```

3.	signal(stop, quit, reload, reopen) 보내기
	
	```
	# nginx -s [stop|quit|reload|reopen]
	```

	stop은 데몬 프로세스를 즉시 멈추게 하지만 quit은 현재 처리 중인 요청들을 모두 정상적으로 응답하게 한 후 멈추는 우아한(graceful) 종료를 한다. reopen은 지정된 로그 파일을 다시 열고 reload는 유용한 옵션으로 설정을 변경한 경우 서버 중지 없이 변경된 설정을 서버에 적용할 수 있다.


### 설정 파일과 로그 파일

1.	/etc/nginx
	설정 파일들이 위치하는 디렉토리이다.
	
2.	/etc/nginx/nginx.conf
	- nginx의 기본 설정 파일로 다음에 언급하는 하위 설정들의 최상위 설정(http)으로 설정의 entry가 된다.
	- 워커 프로세스 개수, 튜닝, 동적 모듈 로딩과 같은 전역 설정을 할 수 있다.
3.	/etc/nginx/conf.d
	- 디렉토리내 .conf 파일들은 모두 상위 nginx.conf의 http 블록에 포함된다.
	- 세부적인 개별적 설정들을 include 구문을 활용해 구조화하면 유지보수에 많은 장점이 있다.												

4.	/var/log/nginx
	로그가 저장되는 디렉토리로 access.log와 error.log 가 있다. 만일 debug 모듈이 활성화 되었다면 디버깅 정보도 로그파일에 기록된다.


## 실습I: 정적 콘텐츠 서비스하기

